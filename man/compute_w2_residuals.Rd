% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_w2_residuals.R
\name{compute_w2_residuals}
\alias{compute_w2_residuals}
\alias{compute_reduced_form_residual_y2}
\title{Compute Reduced Form Residuals for Y2 Variables}
\usage{
compute_w2_residuals(
  yields,
  term_premia,
  maturities = 1:9,
  n_pcs = 4,
  pcs = NULL,
  use_tp_adjustment = TRUE
)

compute_reduced_form_residual_y2(
  yields,
  term_premia,
  maturities = 1:9,
  n_pcs = 4,
  pcs = NULL,
  use_tp_adjustment = TRUE
)
}
\arguments{
\item{yields}{Data frame with yield columns (y1, y2, ..., y10)}

\item{term_premia}{Data frame with term premium columns (tp1, tp2, ..., tp10)}

\item{maturities}{Vector of maturities to process (default: 1:9)}

\item{n_pcs}{Number of principal components to use (default: 4)}

\item{pcs}{Matrix of principal components (T x n_pcs). If NULL, loads from package data.}

\item{use_tp_adjustment}{Logical, whether to adjust yields by term premia (default: TRUE)}
}
\value{
A list containing:
\describe{
\item{residuals}{List of residual vectors, one for each maturity}
\item{fitted}{List of fitted value vectors}
\item{coefficients}{Matrix of regression coefficients (maturities x predictors)}
\item{r_squared}{Vector of R-squared values for each maturity}
\item{n_obs}{Number of observations used in each regression}
}
}
\description{
Computes residuals W_{2,t+1}^{(i)} from regressing Y_{2,t+1}^{(i)} variables
(yield or term premium changes) on principal components and a constant.
}
\details{
For each maturity i, computes Y_{2,t+1}^{(i)} as:
\itemize{
\item If use_tp_adjustment = TRUE: Y_{2,t+1}^{(i)} = y_{t+1}^{(i)} - tp_{t+1}^{(i)}
\item If use_tp_adjustment = FALSE: Y_{2,t+1}^{(i)} = y_{t+1}^{(i)}
}

Then regresses Y_{2,t+1}^{(i)} on PC_t to get residuals W_{2,t+1}^{(i)}.
}
\examples{
\dontrun{
# Load ACM data
acm_data <- extract_acm_data()
yields <- acm_data[, grep("^y", names(acm_data))]
term_premia <- acm_data[, grep("^tp", names(acm_data))]

# Compute residuals for all maturities
res_y2 <- compute_w2_residuals(yields, term_premia)

# Compute for specific maturities only
res_y2_short <- compute_w2_residuals(yields, term_premia, maturities = 1:3)
}
}
