% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_w2_residuals.R
\name{compute_w2_residuals}
\alias{compute_w2_residuals}
\title{Compute Reduced Form Residuals for Y2 Variables}
\usage{
compute_w2_residuals(
  yields,
  term_premia,
  maturities = HETID_CONSTANTS$MIN_MATURITY:(HETID_CONSTANTS$MAX_MATURITY - 1),
  n_pcs = HETID_CONSTANTS$DEFAULT_N_PCS,
  pcs = NULL,
  return_df = FALSE,
  dates = NULL
)
}
\arguments{
\item{yields}{Data frame with columns y1, y2, ..., containing yields}

\item{term_premia}{Data frame with columns tp1, tp2, ..., containing term premia}

\item{maturities}{Vector of maturities to process (default: 1:9)}

\item{n_pcs}{Integer specifying the number of principal components to use.
Must be between 1 and 6. Default is 4 following Adrian, Crump, and Moench (2013).
The choice of n_pcs represents a trade-off between capturing variation in
financial asset returns and maintaining computational stability. More components
capture more variation but may lead to overfitting in finite samples.}

\item{pcs}{Matrix of principal components (n x J) where n is the number of
observations and J is the number of components, extracted from a broader set of
returns of financial assets.}

\item{return_df}{Logical, if TRUE returns a data frame with dates (default FALSE)}

\item{dates}{Optional vector of dates corresponding to the rows in yields/term_premia.
If not provided and return_df = TRUE, will use row indices.}
}
\value{
If return_df = FALSE, returns a list containing:
\describe{
\item{residuals}{List of residual vectors, one for each maturity}
\item{fitted}{List of fitted value vectors}
\item{coefficients}{Matrix of regression coefficients (maturities x predictors)}
\item{r_squared}{Vector of R-squared values for each maturity}
\item{n_obs}{Number of observations used in each regression}
}
If return_df = TRUE, returns a data frame with columns:
\describe{
\item{date}{Date column}
\item{maturity}{Maturity identifier}
\item{residuals}{Residuals \eqn{W_{2,t+1}}}
\item{fitted}{Fitted values from the regression}
}
}
\description{
Computes residuals W_\{2,t+1\}^\{(i)\} from regressing Y_\{2,t+1\}^\{(i)\} variables
(SDF innovations) on principal components extracted from financial asset returns and a constant.
}
\details{
For each maturity i, computes Y_\{2,t+1\}^\{(i)\} as the SDF innovation:
\eqn{Y_{2,t+1}^{(i)} = E_{t+1}[SDF_{t+1+i}] - E_t[SDF_{t+1+i}]}

This is computed using the compute_sdf_innovations() function.
Then regresses Y_\{2,t+1\}^\{(i)\} on PC_t to get residuals W_\{2,t+1\}^\{(i)\}.
}
\examples{
\dontrun{
# Load ACM data - need maturities 1, i-1, i, i+1 for each maturity i
# For maturities 2, 3, we need maturities 1, 2, 3, 4
acm_data <- extract_acm_data(
  data_types = c("yields", "term_premia"),
  maturities = c(1, 2, 3, 4)
)
yields <- acm_data[, grep("^y", names(acm_data))]
term_premia <- acm_data[, grep("^tp", names(acm_data))]

# Compute residuals for specific maturities
res_y2 <- compute_w2_residuals(yields, term_premia, maturities = c(2, 3))

# Get results as data frame
res_y2_df <- compute_w2_residuals(yields, term_premia,
  maturities = c(2, 3),
  return_df = TRUE
)
head(res_y2_df)
}
}
